{% load static i18n %}
<!DOCTYPE html>
<html lang="pt-PT" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- SEO Meta Tags -->
    <title>{% block title %}Livraria Online - Cantos de Papel | Livros Cl√°ssicos e Bestsellers{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Descubra a melhor livraria online de Portugal. Livros cl√°ssicos, bestsellers, fic√ß√£o e n√£o-fic√ß√£o com envio r√°pido em 2-3 dias. Pre√ßos com IVA inclu√≠do. Mais de 10.000 t√≠tulos dispon√≠veis.{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}livraria online, livros portugal, comprar livros, livros cl√°ssicos, bestsellers, fic√ß√£o, literatura, envio r√°pido, livros baratos{% endblock %}">
    <meta name="author" content="Livraria Online - Cantos de Papel">
    <meta name="robots" content="{% block meta_robots %}index, follow{% endblock %}">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Livraria Online - Cantos de Papel | Os Melhores Livros de Portugal{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Descubra milhares de livros com os melhores pre√ßos. Envio r√°pido em 2-3 dias √∫teis. Literatura cl√°ssica e contempor√¢nea.{% endblock %}">
    <meta property="og:image" content="{% block og_image %}{% static 'members/images/og-image.jpg' %}{% endblock %}">
    <meta property="og:locale" content="pt_PT">
    <meta property="og:site_name" content="Livraria Online - Cantos de Papel">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="{% block twitter_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta name="twitter:title" content="{% block twitter_title %}Livraria Online - Cantos de Papel{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}A sua livraria online de confian√ßa. Milhares de t√≠tulos com envio r√°pido.{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% static 'members/images/og-image.jpg' %}{% endblock %}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{% block canonical %}{{ request.build_absolute_uri }}{% endblock %}">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'members/images/favicon.ico' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'members/images/apple-touch-icon.png' %}">
    
    <!-- CSS Unificado -->
    <link rel="stylesheet" href="{% static 'members/css/styles-unified.css' %}?v=14.0">
    
    {% block extra_css %}{% endblock %}
    
    <!-- Structured Data - JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BookStore",
      "name": "Livraria Online - Cantos de Papel",
      "description": "Livraria online especializada em literatura cl√°ssica e contempor√¢nea com envio r√°pido para toda Portugal",
      "url": "{{ request.scheme }}://{{ request.get_host }}",
      "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'members/images/logo.png' %}",
      "image": "{{ request.scheme }}://{{ request.get_host }}{% static 'members/images/og-image.jpg' %}",
      "telephone": "+351-21-XXX-XXXX",
      "email": "info@livraria-online.pt",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Rua das Flores, 123",
        "addressLocality": "Lisboa",
        "postalCode": "1200-195",
        "addressCountry": "PT"
      },
      "priceRange": "‚Ç¨‚Ç¨",
      "openingHours": "Mo-Fr 09:00-18:00",
      "paymentAccepted": "MB Way, Multibanco, Credit Card",
      "currenciesAccepted": "EUR",
      "areaServed": "PT"
    }
    </script>
    {% block structured_data %}{% endblock %}
</head>
<body data-user-auth="{{ request.user.is_authenticated|yesno:'true,false' }}"
    data-login-url="/accounts/login/?next={{ request.path|urlencode }}">
    <!-- Barra Superior de Enlaces -->
    <div class="top-bar-cantos">
        <div class="top-bar-content">
            <div class="top-bar-links">
                <a href="/rede-livrarias/" class="top-bar-link">Rede de livrarias</a>
                <span class="top-bar-separator">|</span>
                <a href="/clube-leitura/" class="top-bar-link">Cart√£o Leitor Cantos de Papel</a>
                <span class="top-bar-separator">|</span>
                <a href="/agenda-cultural/" class="top-bar-link">Agenda cultural</a>
                <span class="top-bar-separator">|</span>
                <a href="/blogue/" class="top-bar-link">Blogue</a>
            </div>
        </div>
    </div>

    <!-- Header Principal - Estilo Bertrand -->
    <div class="header-cantos">
        <div class="header-main">
            <!-- Logo Estilo Bertrand -->
            <a href="/" class="logo-bertrand-style">
                <div class="logo-square">CP</div>
                <div class="logo-text-bertrand">
                    <div class="logo-name">CANTOS DE PAPEL</div>
                    <div class="logo-tagline">LIVREIROS</div>
                </div>
            </a>

            <!-- Barra de Pesquisa -->
            <div class="search-wrapper">
                <form method="get" action="/" class="search-form-cantos">
                    <select name="categoria" class="search-category-cantos">
                                <option value="">{% trans "Todas" %}</option>
                                <option value="Fic√ß√£o">{% trans "Fic√ß√£o" %}</option>
                                <option value="Romance">{% trans "Romance" %}</option>
                                <option value="Fantasia">{% trans "Fantasia" %}</option>
                                <option value="Policial">{% trans "Policial" %}</option>
                                <option value="T√©cnicos">{% trans "T√©cnicos" %}</option>
                                <option value="Infantil">{% trans "Infantil" %}</option>
                    </select>
                    <input type="text" name="q" class="search-input-cantos" 
                                    placeholder="{% trans 'Pesquisar livros, autores...' %}" 
                           value="{{ query|default:'' }}" />
                    <button type="submit" class="search-btn-cantos">
                        <span class="search-icon-cantos">üîç</span>
                    </button>
                </form>
            </div>

            <!-- Bot√µes de Conta Estilo Bertrand -->
            <div class="account-section">
                {% if user.is_authenticated %}
                    <!-- Dropdown de Cuenta -->
                    <div class="account-dropdown-wrapper">
                        <div class="account-dropdown-btn">
                            <div class="icon-circle">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            </div>
                        </div>
                        <div class="account-dropdown-menu">
                            <a href="/perfil/" class="dropdown-item-cantos">{% trans "üë§ Meu Perfil" %}</a>
                            <a href="{% url 'lista_favoritos' %}" class="dropdown-item-cantos">{% trans "‚ù§Ô∏è Favoritos" %}</a>
                            <a href="/perfil/#pedidos" class="dropdown-item-cantos">{% trans "üì¶ Os Meus Pedidos" %}</a>
                            <div class="dropdown-divider-cantos"></div>
                            <form action="/accounts/logout/" method="post" style="margin: 0;">
                                {% csrf_token %}
                                <button type="submit" class="dropdown-item-cantos" style="color: #c0392b;">{% trans "üö™ Terminar Sess√£o" %}</button>
                            </form>
                        </div>
                    </div>
                {% else %}
                    <a href="/accounts/login/" class="account-btn">
                        <div class="icon-circle">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                        </div>
                    </a>
                {% endif %}

                <!-- Favoritos -->
                <a href="{% url 'lista_favoritos' %}" class="account-btn">
                    <div class="icon-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                    </div>
                </a>

                <!-- Carrinho -->
                <div class="cart-btn" onclick="abrirCarrinhoSidebar()" style="cursor: pointer;">
                    <div class="icon-circle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        <span id="cart-count-header" class="cart-count-badge">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navegaci√≥n Secundaria Estilo Bertrand -->
    <div class="nav-secondary-cantos">
        <div class="nav-secondary-content">
            <button class="menu-toggle-btn" onclick="toggleMenu()">
                <span class="menu-icon">‚ò∞</span>
                <span>Menu</span>
            </button>
            <a href="/livros/?filtro=natal" class="nav-link-cantos">{% trans "Natal at√© -50%" %}</a>
            <a href="/?filtro=novidades" class="nav-link-cantos">{% trans "Novidades" %}</a>
            <a href="/livros/?categoria=Fic√ß√£o" class="nav-link-cantos">{% trans "Literatura" %}</a>
            <a href="/livros/?categoria=Infantil" class="nav-link-cantos">{% trans "Infantis e juvenis" %}</a>
            <a href="/livros/?categoria=T√©cnicos" class="nav-link-cantos">{% trans "Livros em Ingl√™s" %}</a>
            <a href="/livros/" class="nav-link-cantos">{% trans "Livr√≥licos" %}</a>
        </div>
    </div>
    </div>

    <!-- Men√∫ Lateral Bertrand -->
    <div id="menu-lateral-overlay" class="menu-lateral-overlay" onclick="cerrarMenuLateral()"></div>
    <div id="menu-lateral" class="menu-lateral">
        <div class="menu-lateral-header">
            <div class="menu-lateral-logo">
                <div class="logo-square-menu">CP</div>
                <div class="logo-text-menu">
                    <div class="logo-name-menu">CANTOS DE PAPEL</div>
                    <div class="logo-tagline-menu">LIVREIROS</div>
                </div>
            </div>
            <button class="menu-close-btn" onclick="cerrarMenuLateral()">√ó</button>
        </div>
        <div class="menu-lateral-content">
            <div class="menu-tabs">
                <button class="menu-tab active" onclick="cambiarTab('online')">LIVRARIA ONLINE</button>
                <button class="menu-tab" onclick="cambiarTab('lojas')">AS NOSSAS LIVRARIAS</button>
            </div>
            <div id="tab-online" class="tab-content active">
                <a href="/livros/" class="menu-item">Livros <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/ebooks/" class="menu-item">eBooks <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/audiolivros/" class="menu-item">Audiolivros <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/ereader/" class="menu-item">eReader <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/livros-escolares/" class="menu-item">Livros Escolares <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/apoio-escolar/" class="menu-item">Apoio Escolar <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/livrolicos/" class="menu-item">Livr√≥licos <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/papelaria/" class="menu-item">Papelaria <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/jogos-brinquedos/" class="menu-item">Jogos e Brinquedos <span class="menu-arrow">‚Ä∫</span></a>
                <a href="/conexoes-literarias/" class="menu-item menu-item-destaque">Conex√µes Liter√°rias <span class="menu-arrow">‚Üí</span></a>
                <a href="/fale-livreiro/" class="menu-item menu-item-gray">Fale com o seu livreiro <span class="menu-arrow">‚Üí</span></a>
                <a href="/leitor-bertrand/" class="menu-item menu-item-dark">Leitor Bertrand <span class="menu-arrow">‚Üí</span></a>
            </div>
            <div id="tab-lojas" class="tab-content">
                <p class="menu-info">As nossas lojas f√≠sicas</p>
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    {% block content %}
    {% endblock %}

    <!-- Footer -->
    <div class="footer-cantos">
        <div class="footer-content">
            <div class="footer-section">
                <h3>Cantos de Papel</h3>
                <p>A sua livraria online de confian√ßa desde 2025</p>
                <p style="margin-top: 15px; color: rgba(255,255,255,0.7);">A cultura ao seu alcance</p>
            </div>
            <div class="footer-section">
                <h4>Links √öteis</h4>
                <a href="/livros/">Cat√°logo</a>
                <a href="/?filtro=novidades">Novidades</a>
                <a href="/?filtro=mais-vendidos">Mais Vendidos</a>
                <a href="/?filtro=ofertas">Ofertas</a>
            </div>
            <div class="footer-section">
                <h4>Apoio ao Cliente</h4>
                <a href="{% url 'politica_privacidad' %}">Pol√≠tica de Privacidade</a>
                <a href="{% url 'terminos_condiciones' %}">Termos e Condi√ß√µes</a>
                <a href="{% url 'politica_cookies' %}">Pol√≠tica de Cookies</a>
                <a href="/privacidade/">Contacto</a>
            </div>
            <div class="footer-section">
                <h4>Newsletter</h4>
                <p>Receba as nossas novidades e promo√ß√µes</p>
                <input type="email" placeholder="O seu email" class="footer-newsletter-input">
                <button class="footer-newsletter-btn">Subscrever</button>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2025 Cantos de Papel - Todos os direitos reservados</p>
        </div>
    </div>

    <!-- Overlay do carrinho -->
    <div id="carrinho-overlay" class="carrinho-overlay" onclick="fecharCarrinhoSidebar()"></div>
    
    <!-- Sidebar do carrinho -->
    <div id="carrinho-sidebar" class="carrinho-sidebar">
        <div class="carrinho-sidebar-header">
            <h2 id="carrinho-sidebar-titulo">1 Produto(s) no carrinho</h2>
            <button class="btn-fechar" onclick="fecharCarrinhoSidebar()">√ó</button>
        </div>
        
        <div id="carrinho-sidebar-content" class="carrinho-sidebar-content">
            <!-- Conte√∫do din√¢mico -->
        </div>
        
        <div class="carrinho-sidebar-footer">
            <div class="sidebar-subtotal">
                <span>Subtotal:</span>
                <strong id="sidebar-subtotal-valor">0,00‚Ç¨</strong>
            </div>
            <button class="btn-ver-carrinho-completo" onclick="window.location.href='/carrinho/'">
                {% trans "Ver carrinho de compras" %}
            </button>
            <button class="btn-finalizar-sidebar" onclick="window.location.href='/carrinho/'">
                {% trans "Finalizar encomenda" %}
            </button>
        </div>
    </div>

    <script>
    // Sistema de carrinho global
    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
    const MSG_ADICIONADO_CARRINHO = "{% trans '‚úì Adicionado ao carrinho!' %}";
    const TEXTO_CARRINHO_VAZIO = "{% trans 'O seu carrinho est√° vazio' %}";
    const ROTULO_PRODUTOS_CARRINHO = "{% trans 'Produto(s) no carrinho' %}";

    function atualizarContadorCarrinho() {
        const contador = document.getElementById('cart-count');
        const contadorHeader = document.getElementById('cart-count-header');
        const totalItens = carrinho.reduce((sum, item) => sum + item.quantidade, 0);
        
        if (contador) {
            contador.textContent = totalItens;
            contador.style.display = totalItens > 0 ? 'flex' : 'none';
        }
        
        if (contadorHeader) {
            contadorHeader.textContent = totalItens;
            contadorHeader.style.display = totalItens > 0 ? 'block' : 'none';
        }
    }

    function adicionarAoCarrinho(id, titulo, preco) {
        const itemExistente = carrinho.find(item => item.id === id);
        
        if (itemExistente) {
            itemExistente.quantidade++;
        } else {
            carrinho.push({
                id: id,
                titulo: titulo,
                preco: parseFloat(preco) || 0,
                quantidade: 1
            });
        }
        
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        atualizarContadorCarrinho();
        
    // Mostrar notifica√ß√£o
    mostrarNotificacao(MSG_ADICIONADO_CARRINHO);
    }

    function mostrarNotificacao(mensagem) {
        const notif = document.createElement('div');
        notif.textContent = mensagem;
        notif.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10000;
            font-weight: bold;
            animation: slideIn 0.3s ease;
        `;
        document.body.appendChild(notif);
        
        setTimeout(() => {
            notif.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notif.remove(), 300);
        }, 2000);
    }

    function abrirCarrinhoSidebar() {
        carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
        
        const overlay = document.getElementById('carrinho-overlay');
        const sidebar = document.getElementById('carrinho-sidebar');
        const titulo = document.getElementById('carrinho-sidebar-titulo');
        const content = document.getElementById('carrinho-sidebar-content');
        const subtotalValor = document.getElementById('sidebar-subtotal-valor');
        
        if (carrinho.length === 0) {
            titulo.textContent = `0 ${ROTULO_PRODUTOS_CARRINHO}`;
            content.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #704214;">
                    <div style="font-size: 3em; margin-bottom: 15px;">üõí</div>
                    <p style="font-size: 1.1em;">${TEXTO_CARRINHO_VAZIO}</p>
                </div>
            `;
            subtotalValor.textContent = '0,00‚Ç¨';
        } else {
            titulo.textContent = `${carrinho.length} ${ROTULO_PRODUTOS_CARRINHO}`;
            
            let html = '';
            let subtotal = 0;
            
            carrinho.forEach((item, index) => {
                const itemSubtotal = item.preco * item.quantidade;
                subtotal += itemSubtotal;
                
                html += `
                    <div class="sidebar-produto-item">
                        <button class="sidebar-btn-remover" onclick="removerItemSidebar(${index}); event.stopPropagation();">√ó</button>
                        <div class="sidebar-produto-img">
                            <span style="font-size: 2em;">üìö</span>
                        </div>
                        <div class="sidebar-produto-info">
                            <h4>${item.titulo}</h4>
                            <p class="sidebar-produto-quantidade">${item.quantidade}x <span class="sidebar-produto-preco">${item.preco.toFixed(2)}‚Ç¨</span></p>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
            subtotalValor.textContent = subtotal.toFixed(2) + '‚Ç¨';
        }
        
        overlay.classList.add('active');
        sidebar.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function fecharCarrinhoSidebar() {
        const overlay = document.getElementById('carrinho-overlay');
        const sidebar = document.getElementById('carrinho-sidebar');
        
        overlay.classList.remove('active');
        sidebar.classList.remove('active');
        document.body.style.overflow = '';
    }

    function removerItemSidebar(index) {
        carrinho.splice(index, 1);
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        atualizarContadorCarrinho();
        abrirCarrinhoSidebar();
    }

    // Atualizar contador al carregar cada p√°gina
    document.addEventListener('DOMContentLoaded', atualizarContadorCarrinho);

    // Toggle Menu Lateral
    function toggleMenu() {
        const overlay = document.getElementById('menu-lateral-overlay');
        const menu = document.getElementById('menu-lateral');
        overlay.classList.add('active');
        menu.classList.add('active');
        document.body.style.overflow = 'hidden';
    }

    function cerrarMenuLateral() {
        const overlay = document.getElementById('menu-lateral-overlay');
        const menu = document.getElementById('menu-lateral');
        overlay.classList.remove('active');
        menu.classList.remove('active');
        document.body.style.overflow = '';
    }

    function cambiarTab(tab) {
        const tabs = document.querySelectorAll('.menu-tab');
        const contents = document.querySelectorAll('.tab-content');
        
        tabs.forEach(t => t.classList.remove('active'));
        contents.forEach(c => c.classList.remove('active'));
        
        if (tab === 'online') {
            tabs[0].classList.add('active');
            document.getElementById('tab-online').classList.add('active');
        } else {
            tabs[1].classList.add('active');
            document.getElementById('tab-lojas').classList.add('active');
        }
    }
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>
