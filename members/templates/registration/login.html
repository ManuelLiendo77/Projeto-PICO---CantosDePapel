{% extends 'base.html' %}

{% block title %}Login - Cantos de Papel{% endblock %}

{% block content %}
<div class="catalog-section">
    <div class="login-container">
        <div class="close-circle" title="Voltar">‚úï</div>
        <h1>‚ú® Bem-vindo!</h1>
        {% if form.errors %}
            <div class="error">
                <strong>‚ö†Ô∏è Erro de Autentica√ß√£o</strong><br>
                Nome de utilizador ou palavra-passe inv√°lidos.
            </div>
        {% endif %}
        <form method="post" action="">
            {% csrf_token %}
            <div class="field">
                <input 
                    type="text" 
                    name="username" 
                    id="id_username" 
                    placeholder="üìß Email" 
                    value="{{ form.username.value|default:'' }}" 
                    required
                    autocomplete="username"
                />
            </div>
            <div class="field" style="position: relative;">
                <input 
                    type="password" 
                    name="password" 
                    id="id_password" 
                    placeholder="üîí Palavra-passe" 
                    required
                    autocomplete="current-password"
                />
                <button type="button" id="togglePassword" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 18px; padding: 5px;" title="Mostrar/Ocultar palavra-passe">
                    üëÅÔ∏è
                </button>
            </div>
            <div class="inline-row">
                <label class="checkbox">
                    <input type="checkbox" name="remember"> 
                    Manter sess√£o
                </label>
                <a href="{% url 'password_reset' %}" class="forgot">Esqueceu a password?</a>
            </div>
            <button type="submit" class="primary">Iniciar Sess√£o</button>

            <div class="separator"><span>Ou</span></div>

            <a href="/accounts/register/" class="cta">
                <span class="icon">‚úâÔ∏è</span>
                N√£o tem conta? Registe-se aqui!
            </a>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    (function(){
        const closeBtn = document.querySelector('.close-circle');
        function closeAction(){
            try{
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    window.location.href = '/';
                }
            } catch(e){
                window.location.href = '/';
            }
        }
        if (closeBtn) closeBtn.addEventListener('click', closeAction);
        document.addEventListener('keydown', function(e){
            if (e.key === 'Escape' || e.key === 'Esc') {
                closeAction();
            }
        });

        // Animaci√≥n de entrada
        const container = document.querySelector('.login-container');
        if (container) {
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            setTimeout(() => {
                container.style.transition = 'all 0.5s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);
        }

        // Toggle password visibility
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('id_password');
        
        if (togglePassword && passwordInput) {
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
            });
        }
    })();
</script>
{% endblock %}