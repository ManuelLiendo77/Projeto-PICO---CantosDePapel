{% extends 'base.html' %}

{% block title %}{{ livro.titulo }} - Cantos de Papel{% endblock %}

{% block extra_css %}
<style>
    /* Container Principal */
    .livro-detalhe-container {
        background: var(--light-bg);
        min-height: 100vh;
        padding: 30px 0;
    }
    
    .detalhe-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
    }
    
    /* Breadcrumb Compacto */
    .breadcrumb {
        background: white;
        padding: 15px 25px;
        border-radius: 12px;
        margin-bottom: 25px;
        font-size: 0.9rem;
        color: var(--text-light);
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .breadcrumb a {
        color: var(--primary-color);
        text-decoration: none;
        transition: color 0.2s;
    }
    
    .breadcrumb a:hover {
        color: var(--primary-hover);
        text-decoration: underline;
    }
    
    .breadcrumb-separator {
        margin: 0 10px;
        color: #ccc;
    }
    
    /* Grid Principal - Layout Amazon */
    .detalhe-grid {
        display: grid;
        grid-template-columns: 380px 1fr 350px;
        gap: 25px;
        margin-bottom: 20px;
    }
    
    /* Coluna Imagem */
    .imagem-col {
        background: white;
        padding: 25px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 480px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .imagem-col img {
        width: 100%;
        max-height: 550px;
        object-fit: contain;
        border-radius: 4px;
    }
    
    .livro-sem-imagem {
        width: 100%;
        height: 480px;
        background: #f0f0f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        color: #999;
    }
    
    .livro-sem-imagem span {
        font-size: 90px;
        margin-bottom: 10px;
    }
    
    /* Coluna Info Principal */
    .info-col {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .titulo-livro {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0 0 10px 0;
        line-height: 1.3;
    }
    
    .autor-livro {
        font-size: 15px;
        color: #007bff;
        margin-bottom: 15px;
    }
    
    .autor-livro a {
        color: #007bff;
        text-decoration: none;
    }
    
    .autor-livro a:hover {
        text-decoration: underline;
        color: #0056b3;
    }
    
    /* Rating Compacto */
    .rating-compacto {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .estrelas-display {
        color: #FFD700;
        font-size: 18px;
        letter-spacing: 2px;
    }
    
    .rating-texto {
        font-size: 14px;
        color: #007bff;
        cursor: pointer;
    }
    
    .rating-texto:hover {
        text-decoration: underline;
    }
    
    /* Badges */
    .badges-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .badge {
        padding: 5px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .badge-categoria {
        background: #e3f2fd;
        color: #1976d2;
    }
    
    .badge-novidade {
        background: #fff3e0;
        color: #f57c00;
    }
    
    .badge-isbn {
        background: #f5f5f5;
        color: #666;
    }
    
    /* Descri√ß√£o com Ler Mais */
    .descricao-section {
        margin: 20px 0;
    }
    
    .descricao-titulo {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
    }
    
    .descricao-texto {
        font-size: 14px;
        line-height: 1.6;
        color: #666;
        margin-bottom: 10px;
    }
    
    .descricao-texto.collapsed {
        max-height: 120px;
        overflow: hidden;
        position: relative;
    }
    
    .descricao-texto.collapsed::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(to bottom, transparent, white);
    }
    
    .btn-ler-mais {
        background: none;
        border: none;
        color: var(--primary-color);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: color 0.2s;
    }
    
    .btn-ler-mais:hover {
        color: var(--primary-hover);
        text-decoration: underline;
    }
    
    /* Detalhes do Produto - Compacto */
    .detalhes-produto {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
    }
    
    .detalhes-lista {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        font-size: 14px;
    }
    
    .detalhe-item {
        display: flex;
        gap: 8px;
    }
    
    .detalhe-label {
        font-weight: 600;
        color: #333;
    }
    
    .detalhe-valor {
        color: #666;
    }
    
    /* Coluna Compra - Estilo Amazon */
    .compra-col {
        position: sticky;
        top: 20px;
        height: fit-content;
    }
    
    .compra-box {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .preco-box {
        margin-bottom: 15px;
    }
    
    .preco-label {
        font-size: 12px;
        color: #565959;
        margin-bottom: 4px;
    }
    
    .preco-valor {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .preco-decimal {
        font-size: 20px;
        vertical-align: super;
    }
    
    .loja-info {
        font-size: 13px;
        color: #666;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-comparar-mini {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        transition: all 0.2s;
    }
    
    .btn-comparar-mini:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255,107,53,0.3);
    }
    
    /* Status Stock */
    .stock-status {
        font-size: 18px;
        font-weight: 500;
        margin: 15px 0;
    }
    
    .stock-status.disponivel {
        color: #007600;
    }
    
    .stock-status.esgotado {
        color: #B12704;
    }
    
    .stock-aviso {
        color: #ff9800;
        font-size: 14px;
        margin-top: 5px;
    }
    
    /* Bot√µes */
    .btn-adicionar-carrinho {
        width: 100%;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
        border: none;
        border-radius: 10px;
        padding: 14px;
        font-size: 1rem;
        font-weight: 700;
        color: white;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(255,107,53,0.3);
    }
    
    .btn-adicionar-carrinho:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255,107,53,0.4);
    }
    
    .btn-favorito {
        width: 100%;
        background: white;
        border: 2px solid var(--primary-color);
        border-radius: 10px;
        padding: 12px;
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--primary-color);
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        display: block;
        text-align: center;
    }
    
    .btn-favorito:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255,107,53,0.3);
    }
    
    .btn-favorito.remover {
        color: #c0392b;
        border-color: #c0392b;
    }
    
    .btn-favorito.remover:hover {
        background: #c0392b;
        color: white;
    }
    
    /* Info Envio */
    .info-envio {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e0e0e0;
        font-size: 13px;
    }
    
    .info-envio-item {
        display: flex;
        align-items: start;
        gap: 8px;
        margin-bottom: 8px;
        color: #666;
    }
    
    .info-envio-icon {
        color: #007600;
        font-size: 16px;
    }
    
    .link-comparar {
        display: block;
        text-align: center;
        color: #007bff;
        font-size: 13px;
        margin-top: 10px;
        text-decoration: none;
    }
    
    .link-comparar:hover {
        text-decoration: underline;
    }
    
    /* Sec√ß√£o Reviews - Compacta */
    .reviews-section {
        background: white;
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 20px;
    }
    
    .reviews-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .reviews-titulo {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0;
    }
    
    .reviews-resumo {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .rating-numero {
        font-size: 32px;
        font-weight: 600;
        color: #333;
    }
    
    .rating-estrelas-grande {
        color: #FFD700;
        font-size: 20px;
    }
    
    .rating-total {
        font-size: 14px;
        color: #666;
    }
    
    .btn-escrever-review {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 28px;
        border-radius: 8px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(255,107,53,0.25);
    }
    
    .btn-escrever-review:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255,107,53,0.35);
    }
    
    /* Review Item - Compacto */
    .review-item {
        padding: 20px 0;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .review-item:last-child {
        border-bottom: none;
    }
    
    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 10px;
    }
    
    .review-usuario {
        font-weight: 600;
        color: #333;
        font-size: 14px;
    }
    
    .review-verificado {
        background: #007600;
        color: white;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 11px;
        margin-left: 8px;
    }
    
    .review-data {
        font-size: 13px;
        color: #999;
    }
    
    .review-estrelas {
        color: #FFD700;
        font-size: 16px;
        margin-bottom: 8px;
    }
    
    .review-titulo {
        font-size: 15px;
        font-weight: 600;
        color: #333;
        margin-bottom: 6px;
    }
    
    .review-texto {
        font-size: 14px;
        line-height: 1.5;
        color: #666;
    }
    
    .reviews-vazio {
        text-align: center;
        padding: 40px 20px;
        color: #999;
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
        .detalhe-grid {
            grid-template-columns: 350px 1fr 320px;
        }
    }
    
    @media (max-width: 992px) {
        .detalhe-grid {
            grid-template-columns: 1fr;
        }
        
        .imagem-col {
            max-width: 380px;
            margin: 0 auto;
        }
        
        .compra-col {
            position: static;
        }
        
        .compra-box {
            max-width: 400px;
            margin: 0 auto;
        }
    }
    
    @media (max-width: 768px) {
        .detalhes-lista {
            grid-template-columns: 1fr;
        }
        
        .breadcrumb {
            font-size: 12px;
            padding: 10px 15px;
        }
        
        .titulo-livro {
            font-size: 20px;
        }
        
        .trailer-section {
            padding: 20px;
        }
        
        .trailer-video-container {
            height: 300px;
        }
    }
    
    /* Secci√≥n Trailer */
    .trailer-section {
        background: white;
        border-radius: 12px;
        padding: 35px;
        margin-bottom: 25px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        border: 1px solid #e8e8e8;
        position: relative;
        overflow: hidden;
    }
    
    .trailer-section::before {
        content: 'üé¨';
        position: absolute;
        top: -20px;
        right: -20px;
        font-size: 120px;
        opacity: 0.03;
        transform: rotate(15deg);
    }
    
    .trailer-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .trailer-icon {
        font-size: 40px;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.1);
        }
    }
    
    .trailer-titulo {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--text-dark);
        margin: 0;
    }
    
    .trailer-subtitulo {
        font-size: 0.95rem;
        color: var(--text-light);
        margin: 8px 0 0 0;
    }
    
    .trailer-content {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 25px;
        align-items: start;
    }
    
    .trailer-video-container {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    
    .trailer-video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 8px;
    }
    
    .trailer-info {
        background: linear-gradient(135deg, #f9f9f9 0%, #f5f5f5 100%);
        padding: 25px;
        border-radius: 10px;
        border: 1px solid #e8e8e8;
    }
    
    .trailer-info-item {
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e8d5c4;
    }
    
    .trailer-info-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    
    .trailer-info-titulo {
        font-size: 16px;
        font-weight: 600;
        color: #5a3e2b;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .trailer-info-texto {
        font-size: 14px;
        color: #6b4e3d;
        line-height: 1.6;
    }
    
    .plataformas-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
    }
    
    .plataforma-badge {
        background: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        color: #5a3e2b;
        border: 1px solid #d4a574;
        transition: all 0.2s;
        display: inline-block;
    }
    
    .plataforma-link {
        text-decoration: none;
        cursor: pointer;
    }
    
    .plataforma-link:hover {
        background: linear-gradient(135deg, #c87941 0%, #d4a574 100%);
        color: white;
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 12px rgba(200, 121, 65, 0.4);
        border-color: #c87941;
    }
    
    .plataforma-badge:not(.plataforma-link):hover {
        background: #f5f5f5;
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* Bot√µes de Streaming */
    .plataformas-streaming {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .btn-streaming {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 14px 24px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn-streaming:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
    }
    
    .btn-streaming:active {
        transform: translateY(-1px);
    }
    
    .btn-netflix {
        background: linear-gradient(135deg, #E50914 0%, #b20710 100%);
        color: white;
    }
    
    .btn-netflix:hover {
        background: linear-gradient(135deg, #F40612 0%, #E50914 100%);
    }
    
    .btn-prime-video {
        background: linear-gradient(135deg, #00A8E1 0%, #0088b8 100%);
        color: white;
    }
    
    .btn-prime-video:hover {
        background: linear-gradient(135deg, #1BB8F1 0%, #00A8E1 100%);
    }
    
    .btn-streaming svg {
        fill: currentColor;
    }
    
    @media (max-width: 992px) {
        .trailer-content {
            grid-template-columns: 1fr;
        }
        
        .plataformas-streaming {
            flex-direction: row;
            flex-wrap: wrap;
        }
        
        .btn-streaming {
            flex: 1;
            min-width: 200px;
        }
    }
    
    @media (max-width: 768px) {
        .trailer-section {
            padding: 20px;
        }
        
        .trailer-video-container {
            height: 300px;
        }
        
        .plataformas-streaming {
            flex-direction: column;
        }
        
        .btn-streaming {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="livro-detalhe-container">
    <div class="detalhe-content">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="{% url 'pagina_principal' %}">In√≠cio</a>
            <span class="breadcrumb-separator">‚Ä∫</span>
            {% if livro.categoria %}
                <a href="{% url 'lista_livros' %}?categoria={{ livro.categoria|urlencode }}">{{ livro.categoria }}</a>
                <span class="breadcrumb-separator">‚Ä∫</span>
            {% endif %}
            <span>{{ livro.titulo }}</span>
        </div>

        <!-- Grid Principal -->
        <div class="detalhe-grid">
            <!-- Coluna 1: Imagem -->
            <div class="imagem-col">
                {% if livro.imagem_capa %}
                    <img src="{{ livro.imagem_capa }}" alt="{{ livro.titulo }}">
                {% else %}
                    <div class="livro-sem-imagem">
                        <span>üìö</span>
                        <p>Imagem n√£o dispon√≠vel</p>
                    </div>
                {% endif %}
            </div>

            <!-- Coluna 2: Informa√ß√£o Principal -->
            <div class="info-col">
                <!-- T√≠tulo -->
                <h1 class="titulo-livro">{{ livro.titulo }}</h1>

                <!-- Autor -->
                <div class="autor-livro">
                    por <a href="#">{{ livro.autor }}</a>
                </div>

                <!-- Rating -->
                <div class="rating-compacto">
                    <div class="estrelas-display">
                        {% for i in "12345" %}
                            {% if forloop.counter <= rating_medio %}‚òÖ{% else %}‚òÜ{% endif %}
                        {% endfor %}
                    </div>
                    <div class="rating-texto" onclick="document.getElementById('reviews-section').scrollIntoView({behavior: 'smooth'})">
                        {{ rating_medio|floatformat:1 }} de 5 estrelas ({{ total_reviews }} {% if total_reviews == 1 %}avalia√ß√£o{% else %}avalia√ß√µes{% endif %})
                    </div>
                </div>

                <!-- Badges -->
                <div class="badges-row">
                    {% if livro.categoria %}
                        <span class="badge badge-categoria">{{ livro.categoria }}</span>
                    {% endif %}
                    {% if livro.novidade %}
                        <span class="badge badge-novidade">‚ú® Novidade</span>
                    {% endif %}
                    {% if livro.isbn %}
                        <span class="badge badge-isbn">ISBN: {{ livro.isbn }}</span>
                    {% endif %}
                </div>

                <!-- Descri√ß√£o com "Ler mais" -->
                {% if livro.descricao %}
                    <div class="descricao-section">
                        <h3 class="descricao-titulo">Sobre este livro</h3>
                        <div class="descricao-texto collapsed" id="descricao-texto">
                            {{ livro.descricao }}
                        </div>
                        <button class="btn-ler-mais" id="btn-ler-mais" onclick="toggleDescricao()">
                            <span id="texto-btn">Ler mais</span>
                            <span id="icone-btn">‚ñº</span>
                        </button>
                    </div>
                {% endif %}

                <!-- Detalhes do Produto -->
                <div class="detalhes-produto">
                    <h3 class="descricao-titulo">Detalhes do Produto</h3>
                    <div class="detalhes-lista">
                        <div class="detalhe-item">
                            <span class="detalhe-label">Formato:</span>
                            <span class="detalhe-valor">{{ tipo_capa }}</span>
                        </div>
                        {% if livro.autor %}
                            <div class="detalhe-item">
                                <span class="detalhe-label">Autor:</span>
                                <span class="detalhe-valor">{{ livro.autor }}</span>
                            </div>
                        {% endif %}
                        {% if livro.categoria %}
                            <div class="detalhe-item">
                                <span class="detalhe-label">Categoria:</span>
                                <span class="detalhe-valor">{{ livro.categoria }}</span>
                            </div>
                        {% endif %}
                        {% if livro.isbn %}
                            <div class="detalhe-item">
                                <span class="detalhe-label">ISBN:</span>
                                <span class="detalhe-valor">{{ livro.isbn }}</span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Coluna 3: Compra -->
            <div class="compra-col">
                <div class="compra-box">
                    <!-- Pre√ßo -->
                    {% if preco_min %}
                        <div class="preco-box">
                            <div class="preco-label">Pre√ßo:</div>
                            <div class="preco-valor">
                                {{ preco_min|floatformat:2 }}<span class="preco-decimal">‚Ç¨</span>
                            </div>
                            {% if loja_min %}
                                <div class="loja-info">
                                    <span>em {{ loja_min }}</span>
                                    <a href="{% url 'comparar_precos' livro.id %}" class="btn-comparar-mini">
                                        üìä Comparar Pre√ßos
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}

                    <!-- Stock -->
                    {% if em_stock %}
                        <div class="stock-status disponivel">
                            ‚úì Em stock
                        </div>
                        {% if stock_baixo %}
                            <div class="stock-aviso">
                                ‚ö†Ô∏è Apenas {{ stock_disponivel }} unidades restantes
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="stock-status esgotado">
                            ‚úó Temporariamente esgotado
                        </div>
                    {% endif %}

                    <!-- Bot√£o Adicionar ao Carrinho -->
                    {% if preco_min and em_stock %}
                        <button 
                            class="btn-adicionar-carrinho"
                            data-livro-id="{{ livro.id }}"
                            data-stock="{{ stock_disponivel }}"
                            data-livro-titulo="{{ livro.titulo|escapejs }}"
                            data-livro-preco="{{ preco_min }}"
                            onclick="adicionarAoCarrinho(this.dataset.livroId, this.dataset.livroTitulo, this.dataset.livroPreco)">
                            üõí Adicionar ao carrinho
                        </button>
                    {% else %}
                        <button class="btn-adicionar-carrinho" disabled style="opacity: 0.5; cursor: not-allowed;">
                            Indispon√≠vel
                        </button>
                    {% endif %}

                    <!-- Bot√£o Favoritos -->
                    {% if user.is_authenticated %}
                        {% if esta_nos_favoritos %}
                            <a href="{% url 'remover_favorito' livro.id %}?next=livro_detalhe" 
                               class="btn-favorito remover">
                                üíî Remover dos favoritos
                            </a>
                        {% else %}
                            <a href="{% url 'adicionar_favorito' livro.id %}?next=livro_detalhe" 
                               class="btn-favorito">
                                ‚ù§Ô∏è Adicionar aos favoritos
                            </a>
                        {% endif %}
                    {% endif %}

                    <!-- Info Envio -->
                    <div class="info-envio">
                        <div class="info-envio-item">
                            <span class="info-envio-icon">üì¶</span>
                            <span><strong>Envio GR√ÅTIS</strong> em compras acima de 20‚Ç¨</span>
                        </div>
                        <div class="info-envio-item">
                            <span class="info-envio-icon">üöö</span>
                            <span>Entrega em <strong>2-3 dias √∫teis</strong></span>
                        </div>
                    </div>

                    <!-- Link Comparar Pre√ßos -->
                    <a href="{% url 'comparar_precos' livro.id %}" class="link-comparar">
                        Ver pre√ßos em outras lojas ‚Üí
                    </a>
                </div>
            </div>
        </div>

        <!-- Sec√ß√£o de Adapta√ß√£o Cinematogr√°fica -->
        {% if filme %}
            <div class="trailer-section">
                <div class="trailer-header">
                    <div class="trailer-icon">üé¨</div>
                    <div>
                        <h2 class="trailer-titulo">Adapta√ß√£o Cinematogr√°fica</h2>
                        <p class="trailer-subtitulo">Este livro foi adaptado para o cinema</p>
                    </div>
                </div>
                
                <div class="trailer-content">
                    <!-- V√≠deo do Trailer -->
                    <div class="trailer-video-wrapper">
                        {% if trailer_url_embebido %}
                            <div class="trailer-video-container">
                                <iframe 
                                    src="{{ trailer_url_embebido }}" 
                                    title="Trailer de {{ filme.titulo }}"
                                    frameborder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                    referrerpolicy="strict-origin-when-cross-origin"
                                    allowfullscreen
                                    loading="lazy">
                                </iframe>
                            </div>
                        {% else %}
                            <div class="trailer-video-container" style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #f0f0f0 0%, #e8e8e8 100%); padding-bottom: 0; height: 400px;">
                                <div style="text-align: center; color: #999;">
                                    <div style="font-size: 60px; margin-bottom: 15px;">üé•</div>
                                    <p style="font-size: 1.1rem; color: #666; margin: 10px 0;">Trailer n√£o dispon√≠vel</p>
                                    <p style="font-size: 0.9rem; margin-top: 10px;">
                                        <a href="https://www.youtube.com/results?search_query={{ livro.titulo|urlencode }}+{{ livro.autor|urlencode }}+trailer+oficial" 
                                           target="_blank" 
                                           style="color: #ff6b35; text-decoration: none; font-weight: 500;">
                                            Procurar no YouTube ‚Üí
                                        </a>
                                    </p>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Informa√ß√£o da Adapta√ß√£o -->
                    <div class="trailer-info">
                        <!-- Detalhes do Filme -->
                        <div class="trailer-info-item">
                            <div class="trailer-info-titulo">
                                üé≠ Detalhes do Filme
                            </div>
                            <div class="trailer-info-texto">
                                <strong>T√≠tulo:</strong> {{ filme.titulo }}<br>
                                <strong>Baseado em:</strong> {{ livro.titulo }}<br>
                                <strong>Autor:</strong> {{ livro.autor }}
                            </div>
                        </div>
                        
                        <!-- Plataformas de Streaming -->
                        {% if plataformas_streaming %}
                        <div class="trailer-info-item">
                            <div class="trailer-info-titulo">
                                üì∫ Dispon√≠vel em
                            </div>
                            <div class="trailer-info-texto" style="margin-bottom: 12px;">
                                Assista ao filme nestas plataformas:
                            </div>
                            <div class="plataformas-streaming">
                                {% for plataforma in plataformas_streaming %}
                                    <a href="{{ plataforma.url }}" 
                                       target="_blank" 
                                       rel="noopener noreferrer"
                                       class="btn-streaming btn-{{ plataforma.logo_class }}"
                                       title="Ver na {{ plataforma.nome }}">
                                        {% if plataforma.nome == 'Netflix' %}
                                            <svg width="24" height="24" viewBox="0 0 256 256" style="margin-right: 8px;">
                                                <g fill="#e50914">
                                                    <path d="M140.803 258.904c-15.404 2.705-31.079 3.516-47.294 5.676l-49.458-144.856v151.073c-15.404 1.621-29.457 3.783-44.051 5.945v-276.742h41.08l56.212 157.021v-157.021h43.511v258.904zm85.131-157.558c16.757 0 42.431-.811 57.835-.811v43.24c-19.189 0-41.619 0-57.835.811v64.322c25.405-1.621 50.809-3.785 76.482-4.596v41.617l-119.724 9.461v-255.39h119.724v43.241h-76.482v58.105zm237.284-58.104h-44.862v198.908c-14.594 0-29.188 0-43.239.539v-199.447h-44.862v-43.242h132.965l-.002 43.242z"/>
                                                </g>
                                            </svg>
                                            Ver na Netflix
                                        {% elif plataforma.nome == 'Prime Video' %}
                                            <svg width="24" height="24" viewBox="0 0 256 256" style="margin-right: 8px;">
                                                <g fill="#00a8e1">
                                                    <path d="M245.55 195.87c-9.94 7.86-24.44 12.07-36.88 12.07-24.97 0-47.32-9.27-59.86-24.78-2.48-3.08-2.19-7.64.65-10.37 2.84-2.74 7.39-2.45 10.17.47 9.57 10.05 25.62 16.32 42.39 16.32 9.53 0 20.61-2.72 28.15-7.34 1.56-.95 1.88-2.41 1.88-3.58 0-1.99-1.39-3.49-3.88-4.22-9.56-2.77-20.35-4.08-31.24-5.43-13.95-1.72-28.38-3.5-40.95-10.44-13.92-7.67-21.81-21.52-21.81-38.08 0-26.18 21.27-44.6 51.54-44.6 17.31 0 33.66 5.38 46 15.16 2.83 2.25 3.29 6.35 1.04 9.18-2.25 2.82-6.35 3.29-9.18 1.04-9.58-7.59-21.24-11.64-33.95-11.64-21.62 0-37.27 13.05-37.27 31.07 0 11.42 4.94 20.43 14.29 26.04 9.49 5.69 21.46 7.13 33.12 8.54 11.74 1.42 23.88 2.89 34.97 6.44 13.31 4.27 21.62 13.5 21.62 24.11 0 6.91-2.8 13.21-8.11 18.23"/>
                                                </g>
                                            </svg>
                                            Ver no Prime Video
                                        {% endif %}
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                        {% else %}
                        <div class="trailer-info-item">
                            <div class="trailer-info-titulo">
                                üì∫ Onde Assistir
                            </div>
                            <div class="trailer-info-texto">
                                Verifique a disponibilidade do filme nas plataformas de streaming:
                            </div>
                            <div class="plataformas-list">
                                <a href="https://www.netflix.com/search?q={{ livro.titulo|urlencode }}" 
                                   target="_blank" 
                                   class="plataforma-badge plataforma-link"
                                   title="Procurar na Netflix">
                                    Netflix
                                </a>
                                <a href="https://www.primevideo.com/search/ref=atv_nb_sr?phrase={{ livro.titulo|urlencode }}" 
                                   target="_blank" 
                                   class="plataforma-badge plataforma-link"
                                   title="Procurar no Prime Video">
                                    Prime Video
                                </a>
                                <span class="plataforma-badge">Disney+</span>
                                <span class="plataforma-badge">HBO Max</span>
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Dica de Leitura -->
                        <div class="trailer-info-item">
                            <div class="trailer-info-titulo">
                                üí° Dica de Leitura
                            </div>
                            <div class="trailer-info-texto">
                                Leia o livro antes de ver o filme para uma experi√™ncia completa e aprofundada da hist√≥ria!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <!-- Sec√ß√£o de Avalia√ß√µes -->
        <div class="reviews-section" id="reviews-section">
            <div class="reviews-header">
                <div>
                    <h2 class="reviews-titulo">Avalia√ß√µes de clientes</h2>
                </div>
                <div class="reviews-resumo">
                    <div class="rating-numero">{{ rating_medio|floatformat:1 }}</div>
                    <div>
                        <div class="rating-estrelas-grande">
                            {% if rating_medio > 0 %}
                                {% for i in "12345" %}
                                    {% if forloop.counter <= rating_medio %}‚òÖ{% else %}‚òÜ{% endif %}
                                {% endfor %}
                            {% else %}
                                ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ
                            {% endif %}
                        </div>
                        <div class="rating-total">{{ total_reviews }} {% if total_reviews == 1 %}avalia√ß√£o{% else %}avalia√ß√µes{% endif %}</div>
                    </div>
                    <div>
                        {% if pode_avaliar %}
                            <a href="{% url 'submeter_review' livro.id %}" class="btn-escrever-review">
                                ‚úçÔ∏è Escrever avalia√ß√£o
                            </a>
                        {% elif review_utilizador %}
                            <div style="font-size: 13px; color: #28a745; margin-bottom: 8px;">‚úì J√° avaliou este livro</div>
                            <a href="{% url 'editar_review' review_utilizador.id %}" 
                               style="font-size: 13px; color: #007bff; text-decoration: none; margin-right: 10px;">
                                Editar
                            </a>
                                     <a href="{% url 'remover_review' review_utilizador.id %}" 
                                         style="font-size: 13px; color: #dc3545; text-decoration: none;">
                                          Remover
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Lista de Reviews -->
            {% if reviews %}
                {% for review in reviews %}
                    <div class="review-item">
                        <div class="review-header">
                            <div>
                                <span class="review-usuario">{{ review.utilizador.username }}</span>
                                {% if review.verificado %}
                                    <span class="review-verificado">‚úì Compra Verificada</span>
                                {% endif %}
                            </div>
                            <span class="review-data">{{ review.data_criacao|date:"d/m/Y" }}</span>
                        </div>
                        <div class="review-estrelas">
                            {% for i in "12345" %}
                                {% if forloop.counter <= review.rating %}‚òÖ{% else %}‚òÜ{% endif %}
                            {% endfor %}
                        </div>
                        <h4 class="review-titulo">{{ review.titulo }}</h4>
                        <p class="review-texto">{{ review.comentario }}</p>
                    </div>
                {% endfor %}
            {% else %}
                <div class="reviews-vazio">
                    <p style="font-size: 16px; margin-bottom: 10px;">Ainda n√£o h√° avalia√ß√µes para este livro.</p>
                    {% if pode_avaliar %}
                        <p style="color: #666;">Seja o primeiro a avaliar!</p>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Voltar -->
        <div style="text-align: center; margin: 20px 0;">
            <a href="{% url 'pagina_principal' %}" 
               style="display: inline-block; color: #007bff; text-decoration: none; font-size: 14px; padding: 10px 20px; border: 1px solid #007bff; border-radius: 6px;">
                ‚Üê Voltar √† p√°gina principal
            </a>
        </div>
    </div>
</div>

<!-- JavaScript para "Ler mais" -->
<script>
function toggleDescricao() {
    const descricaoTexto = document.getElementById('descricao-texto');
    const textBtn = document.getElementById('texto-btn');
    const iconeBtn = document.getElementById('icone-btn');
    
    if (descricaoTexto.classList.contains('collapsed')) {
        descricaoTexto.classList.remove('collapsed');
        textBtn.textContent = 'Ler menos';
        iconeBtn.textContent = '‚ñ≤';
    } else {
        descricaoTexto.classList.add('collapsed');
        textBtn.textContent = 'Ler mais';
        iconeBtn.textContent = '‚ñº';
    }
}
</script>
{% endblock %}
